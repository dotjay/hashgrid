!function(a,b){var c=function(){function a(a,b){var c,d=Object.getOwnPropertyNames(b),e=d.length;for(c=0;e>c;c++)a[d[c]]=b[d[c]]}return{getKey:function(a){var b=!1,c=a.keyCode?a.keyCode:a.which;return b=13==c?"enter":String.fromCharCode(c).toLowerCase()},getKeyModifier:function(a,b){if(null===b)return!0;var c=!0;switch(b){case"ctrl":c=a.ctrlKey?a.ctrlKey:!1;break;case"alt":c=a.altKey?a.altKey:!1;break;case"shift":c=a.shiftKey?a.shiftKey:!1}return c},mergeObjects:function(b,c,d){return b||c||d?b&&"object"!=typeof b||c&&"object"!=typeof c||d&&"object"!=typeof d?{}:(c&&a(b,c),d&&a(b,d),b):{}},forceRepaint:function(){var a=b.styleSheets[0];try{a.addRule(".xxxxxx","position: relative"),a.removeRule(a.rules.length-1)}catch(c){}}}}();"undefined"!=typeof module&&module.exports&&(module.exports=c);var d=function(){function a(){}return a.prototype.read=function(a){var c,d=b.cookie.split(";"),e=0,f=d.length;for(a+="=";f>e;e++){for(c=d[e];" "===c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(a))return JSON.parse(c.substring(a.length,c.length))}return null},a.prototype.write=function(a,c,d){var e,f="",g="";return d&&(e=new Date,e.setTime(e.getTime()+24*d*60*60*1e3),f="; expires="+e.toGMTString()),g=a+"="+JSON.stringify(c)+f+"; path=/",b.cookie=g,g},a.prototype.remove=function(a){var b=this.read(a);return b?(this.write(a,"",-1),b):null},a}();"undefined"!=typeof module&&module.exports&&(module.exports=d);var e=function(){function b(){this.storage=a.localStorage}return b.prototype.read=function(a){var b=this.storage.getItem(a);return b?JSON.parse(b):null},b.prototype.write=function(a,b){return this.storage.setItem(a,JSON.stringify(b)),b},b.prototype.remove=function(a){var b=this.read(a);return b?(this.storage.removeItem(a),b):null},b}();if("undefined"!=typeof module&&module.exports&&(module.exports=e),"undefined"!=typeof module&&module.exports)var e=require("./localStorage"),d=require("./cookieStorage");var f=function(){return this.hasLocalStorage()?new e:new d};if(f.prototype.hasLocalStorage=function(){try{var b=a.localStorage,c="some value";return b.setItem(c,c),b.removeItem(c),!0}catch(d){return!1}},"undefined"!=typeof module&&module.exports&&(module.exports=f),"undefined"!=typeof module&&module.exports)var f=require("./storage"),c=require("./helper");var g=function(){function a(a){var b={id:"hashgrid",modifierKey:null,showGridKey:"g",holdGridKey:"h",foregroundKey:"f",jumpGridsKey:"j",numberOfGrids:1,classPrefix:"hashgrid",storagePrefix:"hashgrid"},d={overlayZBG:"-1",overlayZFG:"9999"};this.options=c.mergeObjects(b,a,d),this.state={},this.state.overlayHold=!1,this.state.overlayOn=!1,this.state.overlayZIndex="B",this.state.isKeyDown={},this.init()}var d=new f;return a.prototype.init=function(){var a;this.overlay=b.createElement("div"),this.overlay.id=this.options.id,this.overlay.style.display="none",this.overlay.style.pointerEvents="none",this.overlay.style.height=b.body.scrollHeight+"px","auto"===this.overlay.style.zIndex&&(this.overlay.style.zIndex=this.overlayZBackground),b.body.insertBefore(this.overlay,b.body.firstChild),b.addEventListener?(b.addEventListener("keydown",keydownHandler.bind(this),!1),b.addEventListener("keyup",keyupHandler.bind(this),!1)):b.attachEvent&&(b.attachEvent("onkeydown",keydownHandler.bind(this)),b.attachEvent("onkeyup",keyupHandler.bind(this))),fillGrid.call(this),a=d.read(this.options.storagePrefix+this.options.id),a&&(a.overlayHold&&(this.overlay.style.display="block",this.state.overlayOn=!0,this.state.overlayHold=!0),a.overlayZIndex&&("B"===a.overlayZIndex?this.overlay.style.zIndex=this.options.overlayZBG:"F"===a.overlayZIndex&&(this.overlay.style.zIndex=this.options.overlayZFG)))},a.prototype.showOverlay=function(){this.overlay.style.display="block",this.state.overlayOn=!0},a.prototype.hideOverlay=function(){this.overlay.style.display="none",this.state.overlayOn=!1},a.prototype.destroy=function(){this.overlay.remove(),b.removeEventListener?(b.removeEventListener("keydown",keydownHandler,!1),b.removeEventListener("keyup",keyupHandler,!1)):b.detachEvent&&(b.detachEvent("onkeydown",keydownHandler),b.detachEvent("onkeyup",keyupHandler))},fillGrid=function(){var a,c,d,e,f,g,h=b.createElement("div"),i=b.createElement("div"),j=b.createDocumentFragment(),k=this.options,l=this.overlay,m=b.createElement("div"),n=b.createElement("div");if(m.classList.add(k.id+"-row-container"),h.classList.add(k.id+"-column-container"),l.appendChild(m),l.appendChild(h),n.classList.add(k.id+"__row"),i.classList.add(k.id+"__column"),m.appendChild(n),h.appendChild(i),l.style.display="block",l.top="-9999px",d=l.scrollHeight,e=l.scrollWidth,g=n.getBoundingClientRect().height,c=i.clientWidth,l.style.display="none",l.top="0",!g||!c)return!1;for(f=Math.floor(d/g)-1,a=Math.floor(e/c)-2;f--;)n=b.createElement("div"),n.classList.add(k.id+"__row"),j.appendChild(n);for(m.appendChild(j);a--;)i=b.createElement("div"),i.classList.add(k.id+"__column"),j.appendChild(i);h.appendChild(j)},keydownHandler=function(a){var b,e,f=this.options;if(state=this.state,source=a.target.tagName.toLowerCase(),"input"==source||"textarea"==source||"select"==source)return!0;if(e=c.getKeyModifier(a,f.modifierKey),!e)return!0;if(b=c.getKey(a),!b)return!0;if(state.isKeyDown[b])return!0;switch(state.isKeyDown[b]=!0,b){case f.showGridKey:state.overlayOn?state.overlayHold&&(this.hideOverlay(),state.overlayOn=!1,state.overlayHold=!1,d.write(f.storagePrefix+f.id,createStorageData.call(this))):(this.showOverlay(),state.overlayOn=!0);break;case f.holdGridKey:state.overlayOn&&!state.overlayHold&&(state.overlayHold=!0,d.write(f.storagePrefix+f.id,createStorageData.call(this)));break;case f.foregroundKey:state.overlayOn&&(this.overlay.style.zIndex===f.overlayZFG?(this.overlay.style.zIndex=f.overlayZBG,state.overlayZIndex="B"):(this.overlay.style.zIndex=f.overlayZFG,state.overlayZIndex="F"),d.write(f.storagePrefix+f.id,createStorageData.call(this)));break;case f.jumpGridsKey:}return!0},keyupHandler=function(a){var b,d=c.getKeyModifier(a),e=this.options,f=this.state;return d?(b=c.getKey(a),delete f.isKeyDown[b],b&&b==e.showGridKey&&!f.overlayHold&&(this.hideOverlay(),f.overlayOn=!1),!0):!0},createStorageData=function(){var a=this.state;return{overlayHold:a.overlayHold,overlayZIndex:a.overlayZIndex}},a}();a.Hashgrid=g,"undefined"!=typeof module&&module.exports&&(module.exports=g)}(window,document);